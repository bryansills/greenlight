{"version":3,"sources":["webpack:///./src/templates/CityMap.js","webpack:///./src/utils/process.js","webpack:///./src/components/FullScreenMap.js","webpack:///./src/components/HeatMap.js","webpack:///./src/components/Dropdown.js","webpack:///./src/components/ObstructionMap.js"],"names":["__webpack_require__","r","__webpack_exports__","d","query","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","n","_components_ObstructionMap__WEBPACK_IMPORTED_MODULE_1__","_utils_process__WEBPACK_IMPORTED_MODULE_2__","_ref","data","cityConfig","obstructions","points","position","zoom","a","createElement","id","options","result","getGroupedPoints","file","selectedOption","groupedMap","filter","obstruction","reduce","acc","_ref2","_Object$assign","lat","long","key","value","count","Object","assign","values","sort","left","right","map","_ref3","FullScreenMap","_React$Component","_this","_len","arguments","length","args","Array","_key","call","apply","this","concat","state","_updateDimensions","window","height","innerHeight","setState","forceUpdate","inheritsLoose_default","_proto","prototype","componentDidMount","addEventListener","componentWillUnmount","removeEventListener","render","_this$props","props","children","rest","objectWithoutPropertiesLoose_default","react_default","Map","style","React","Component","HeatMap","className","mapStyle","FullScreenMap_FullScreenMap","center","TileLayer","attribution","url","HeatmapLayer_default","latitudeExtractor","m","longitudeExtractor","intensityExtractor","parseFloat","Dropdown","_onChange","event","onChange","target","_renderOptions","option","spinner","dropdownStyles","spinner_container","defaultProps","ObstructionMap","_onChangeObstruction","HeatMap_HeatMap","Dropdown_Dropdown"],"mappings":"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","file":"component---src-templates-city-map-js-64e4ef2c5f382c5b95bc.js","sourcesContent":["import React from \"react\"\nimport { graphql } from \"gatsby\"\nimport { ObstructionMap } from \"../components/ObstructionMap\"\nimport { getGroupedPoints } from \"../utils/process\"\n\nexport default ({ data }) => {\n    const { cityConfig, obstructions, points } = data\n    const { position, zoom } = cityConfig\n    \n    return (\n        <div id={\"map\"}>\n            <ObstructionMap\n                position={position}\n                zoom={zoom}\n                options={obstructions.result}\n                getGroupedPoints={getGroupedPoints(points.file.result)} />\n        </div>\n    )\n}\n\nexport const query = graphql`\n    query($slug: String!) {\n        cityConfig: citiesJson(fields: { slug: { eq: $slug } }) {\n            name,\n            position,\n            zoom,\n            heat_radius\n        },\n        obstructions: file(\n            sourceInstanceName: { eq: \"data\" },\n            relativePath: { eq: \"obstructions.json\" }\n        ) {\n            result: childrenObstructionsJson {\n                key,\n                spinner,\n                data\n            }\n        },\n        points: file(\n            sourceInstanceName: { eq: \"points\" },\n            relativePath: { eq: \"all.json\" }\n        ) {\n            file: childPointsJson {\n                result {\n                    lat,\n                    long,\n                    obstruction\n                }\n            }\n        }\n    }\n`\n","export const getGroupedPoints = (points) => (selectedOption) => {\n    const groupedMap = points\n        .filter(({obstruction}) => {\n            return obstruction === selectedOption || selectedOption === \"all\"\n        })\n        .reduce((acc, {lat, long}) => {\n            const key = `${lat},${long}`\n            const value = acc[key]\n            const count = value ? value.count : 0\n            return {\n                ...acc,\n                [key]: {\n                    lat,\n                    long,\n                    count: count + 1\n                }\n            }\n        }, {})\n\n    return Object.values(groupedMap)\n        .sort((left, right) => right.count - left.count)\n        .map(({ lat, long, count }) => [lat, long, count])\n}\n","import React from \"react\"\nimport { Map } from \"react-leaflet\"\n\nexport class FullScreenMap extends React.Component {\n    state = {}\n\n    componentDidMount() {\n        if (typeof window !== 'undefined') {\n            window.addEventListener(\"resize\", this._updateDimensions)\n            this._updateDimensions()\n        }\n    }\n\n    componentWillUnmount() {\n        if (typeof window !== 'undefined') {\n            window.removeEventListener(\"resize\", this._updateDimensions)\n        }\n    }\n\n    _updateDimensions = () => {\n        if (typeof window !== 'undefined') {\n            const height = window.innerHeight\n            this.setState({ height: height })\n            this.forceUpdate()\n        }\n    }\n\n    render() {\n        const { children, ...rest } = this.props\n        const height = this.state.height\n\n        if (typeof window !== 'undefined' && height) {\n            return (\n                <Map style={{ height }} { ...rest }>\n                    { children }\n                </Map>\n            )\n        } else {\n            return null\n        }\n    }\n}\n","import React from \"react\"\nimport { TileLayer } from \"react-leaflet\"\nimport HeatmapLayer from \"react-leaflet-heatmap-layer\"\nimport { FullScreenMap } from \"./FullScreenMap\"\nimport mapStyle from \"./map.module.css\"\n\nexport class HeatMap extends React.Component {\n    render() {\n        const { position, zoom, points } = this.props\n\n        return (\n            <div className={mapStyle.map}>\n                <FullScreenMap center={position} zoom={zoom}>\n                    <TileLayer\n                        attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n                        url='https://{s}.tile.osm.org/{z}/{x}/{y}.png'\n                    />\n                    { points && points.length > 0 && <HeatmapLayer\n                        points={points}\n                        latitudeExtractor={m => m[0]}\n                        longitudeExtractor={m => m[1]}\n                        intensityExtractor={m => parseFloat(m[2])}\n                    /> }\n                </FullScreenMap>\n            </div>\n        )\n    }\n}\n","import React from \"react\"\nimport dropdownStyles from \"./dropdown.module.css\"\n\nexport class Dropdown extends React.Component {\n    static defaultProps = {\n        options: []\n    }\n\n    _onChange = (event) => {\n        this.props.onChange(event.target.value)\n    }\n\n    _renderOptions = () => {\n        const { options } = this.props\n\n        return options.map(option => {\n            return <option key={option.key} value={option.key}>{ option.spinner }</option>\n        })\n    }\n\n    render() {\n        const { selectedOption } = this.props\n\n        return(\n            <div className={dropdownStyles.spinner_container}>\n                <select value={selectedOption} onChange={this._onChange}>\n                    { this._renderOptions() }\n                </select>\n            </div>\n        )\n    }\n}\n","import React from \"react\"\nimport { HeatMap } from \"../components/HeatMap\"\nimport { Dropdown } from \"./Dropdown\"\n\nexport class ObstructionMap extends React.Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            selectedOption: props.options[0].key\n        }\n    }\n\n    _onChangeObstruction = (key) => this.setState({ selectedOption: key })\n\n    render() {\n        const { position, zoom, options, getGroupedPoints } = this.props\n        const { selectedOption } = this.state\n        const points = getGroupedPoints(selectedOption)\n\n        return(\n            <div>\n                <HeatMap position={position} zoom={zoom} points={points} />\n                <Dropdown options={options} selectedOption={selectedOption} onChange={this._onChangeObstruction} />\n            </div>\n        )\n    }\n}\n"],"sourceRoot":""}