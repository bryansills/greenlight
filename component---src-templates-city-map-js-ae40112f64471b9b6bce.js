(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{146:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),r=n(7),i=n.n(r),s=n(166),u=n(169),c=n.n(u),p=(n(33),n(76)),l=n.n(p),d=n(164),m=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).state={},e._updateDimensions=function(){if("undefined"!=typeof window){var t=window.innerHeight;e.setState({height:t}),e.forceUpdate()}},e}i()(e,t);var n=e.prototype;return n.componentDidMount=function(){"undefined"!=typeof window&&(window.addEventListener("resize",this._updateDimensions),this._updateDimensions())},n.componentWillUnmount=function(){"undefined"!=typeof window&&window.removeEventListener("resize",this._updateDimensions)},n.render=function(){var t=this.props,e=t.children,n=l()(t,["children"]),a=this.state.height;return"undefined"!=typeof window&&a?o.a.createElement(d.a,Object.assign({style:{height:a}},n),e):null},e}(o.a.Component),f=n(142),h=n.n(f),g=function(t){function e(){return t.apply(this,arguments)||this}return i()(e,t),e.prototype.render=function(){var t=this.props,e=t.position,n=t.zoom,a=t.points;return o.a.createElement("div",{className:h.a.map},o.a.createElement(m,{center:e,zoom:n},o.a.createElement(s.a,{attribution:'Â© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png"}),a&&a.length>0&&o.a.createElement(c.a,{points:a,latitudeExtractor:function(t){return t[0]},longitudeExtractor:function(t){return t[1]},intensityExtractor:function(t){return parseFloat(t[2])}})))},e}(o.a.Component),v=n(181),y=n.n(v),b=(n(143),n(144)),w=n.n(b),D=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))||this)._onChange=function(t){e.props.onObstructionChange(t.target.value)},e._formatLabel=function(t,n){var a=e.props.baseDate;return"max"===n?"Latest":"min"===n?"Oldest":a.clone().add(t,"days").format("MMM YYYY")},e._renderOptions=function(){return e.props.obstructions.map(function(t){return o.a.createElement("option",{key:t.key,value:t.key},t.spinner)})},e}return i()(e,t),e.prototype.render=function(){var t=this.props,e=t.selectedObstruction,n=t.minDate,a=t.maxDate,r=t.dateRange,i=t.onDateRangeChange;return o.a.createElement("div",{className:w.a.filters_positioning},o.a.createElement("div",{className:w.a.filters_container},o.a.createElement("select",{value:e,onChange:this._onChange},this._renderOptions()),o.a.createElement(y.a,{minValue:n,maxValue:a,value:r,formatLabel:this._formatLabel,onChange:i})))},e}(o.a.Component);D.defaultProps={obstructions:[]};var E=n(168),_=n.n(E),C=function(t){function e(e){var n;(n=t.call(this,e)||this)._onObstructionChange=function(t){return n.setState({selectedOption:t})},n._onDateRangeChange=function(t){return n.setState({dateRange:t})},n._getPoints=function(){var t=n.props.getGroupedPoints,e=n.state,a=e.selectedOption,o=e.baseDate,r=e.dateRange,i=r.min,s=r.max;return t(a,o.clone().add(i,"days"),o.clone().add(s,"days"))};var a=_()("2017-08-29"),o=_()().diff(a,"days");return n.state={selectedOption:e.options[0].key,baseDate:a,minDate:0,maxDate:o,dateRange:{min:0,max:o}},n}return i()(e,t),e.prototype.render=function(){var t=this.props,e=t.position,n=t.zoom,a=t.options,r=this.state,i=r.selectedOption,s=r.baseDate,u=r.minDate,c=r.maxDate,p=r.dateRange;return o.a.createElement("div",null,o.a.createElement(g,{position:e,zoom:n,points:this._getPoints()}),o.a.createElement(D,{obstructions:a,selectedObstruction:i,onObstructionChange:this._onObstructionChange,baseDate:s,minDate:u,maxDate:c,dateRange:p,onDateRangeChange:this._onDateRangeChange}))},e}(o.a.Component),O=(n(75),n(55),n(36),n(197),n(199),function(t){return function(e,n,a){var o=t.filter(function(t){return t.obstruction===e||"all"===e}).filter(function(t){var e=t.timestamp;return _()(e).isBetween(n,a,"day","[]")}).reduce(function(t,e){var n,a=e.lat,o=e.long,r=a+","+o,i=t[r],s=i?i.count:0;return Object.assign({},t,((n={})[r]={lat:a,long:o,count:s+1},n))},{});return Object.values(o).sort(function(t,e){return e.count-t.count}).map(function(t){return[t.lat,t.long,t.count]})}});n.d(e,"query",function(){return x});e.default=function(t){var e=t.data,n=e.cityConfig,a=e.obstructions,r=e.points,i=n.position,s=n.zoom;return o.a.createElement("div",{id:"map"},o.a.createElement(C,{position:i,zoom:s,options:a.result,getGroupedPoints:O(r.file.result)}))};var x="504971141"}}]);
//# sourceMappingURL=component---src-templates-city-map-js-ae40112f64471b9b6bce.js.map